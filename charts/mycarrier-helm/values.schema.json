{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["global", "environment"],
  "properties": {
    "global": {
      "type": "object",
      "required": ["appStack", "language"],
      "properties": {
        "appStack": {
          "type": "string",
          "description": "The application stack name, used for naming resources and grouping applications"
        },
        "language": {
          "type": "string",
          "description": "Programming language used by the application",
          "enum": ["csharp", "nodejs", "java", "python", "nginx"]
        },
        "gitbranch": {
          "oneOf": [
            { "type": "string", "description": "Name of the git branch (used for feature branches)" },
            { "type": "null" }
          ]
        },
        "branchlabel": {
          "oneOf": [
            { "type": "string", "description": "Label for the branch, used for reference label" },
            { "type": "null" }
          ]
        },
        "forceAutoscaling": {
          "type": "boolean",
          "description": "Force autoscaling to be enabled regardless of environment",
          "default": false
        }
      }
    },
    "environment": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Environment name (dev, preprod, prod, or feature*)",
          "pattern": "^(dev|preprod|prod|feature.+)$"
        },
        "dependencyenv": {
          "oneOf": [
            { "type": "string", "description": "Environment name for dependencies", "default": "dev" },
            { "type": "null" }
          ]
        },
        "domainOverride": {
          "oneOf": [
            { 
              "type": "object",
              "properties": {
                "enabled": {
                  "oneOf": [
                    { "type": "boolean", "description": "Whether to override the default domain", "default": false },
                    { "type": "null" }
                  ]
                },
                "domain": {
                  "oneOf": [
                    { "type": "string", "description": "Domain to use when override is enabled" },
                    { "type": "null" }
                  ]
                }
              }
            },
            { "type": "null" }
          ]
        }
      }
    },
    "enableVaultCA": {
      "oneOf": [
        { "type": "boolean", "description": "Enable Vault CA certificate download during pod startup", "default": false },
        { "type": "null" }
      ]
    },
    "disableOtelAutoinstrumentation": {
      "oneOf": [
        { "type": "boolean", "description": "Disable OpenTelemetry automatic instrumentation", "default": true },
        { "type": "null" }
      ]
    },
    "tolerations": {
      "oneOf": [
        { "type": "array", "description": "Default tolerations for all applications", 
          "items": {
            "type": "object",
            "properties": {
              "key": {
                "type": "string"
              },
              "operator": {
                "type": "string",
                "enum": ["Equal", "Exists"]
              },
              "value": {
                "type": "string"
              },
              "effect": {
                "type": "string",
                "enum": ["NoSchedule", "PreferNoSchedule", "NoExecute"]
              },
              "tolerationSeconds": {
                "type": "integer"
              }
            }
          }
        },
        { "type": "null" }
      ]
    },
    "applications": {
      "type": "object",
      "patternProperties": {
        "^[a-z0-9_-]+$": {
          "type": "object",
          "required": ["image"],
          "properties": {
          "isFrontend": {
            "oneOf": [
              {
                "type": "boolean",
                "description": "Whether this is a frontend application",
                "default": false
              },
              {
                "type": "null"
              }
            ]
          },
          "forceOffload": {
            "oneOf": [
              {
                "type": "boolean",
                "description": "Whether to force offloading",
                "default": false
              },
              {
                "type": "null"
              }
            ]
          },
          "staticHostname": {
            "oneOf": [
              {
                "type": "string",
                "description": "Static hostname for the application"
              },
              {
                "type": "null"
              }
            ]
          },
          "labels": {
            "oneOf": [
              {
                "type": "object",
                "description": "Custom labels to add to the application resources",
                "additionalProperties": {
                  "type": "string"
                }
              },
              {
                "type": "null"
              }
            ]
          },
          "annotations": {
            "oneOf": [
              {
                "type": "object",
                "description": "Custom annotations to add to the application resources",
                "additionalProperties": {
                  "type": "string"
                }
              },
              {
                "type": "null"
              }
            ]
          },
          "testtrigger": {
            "type": "object",
            "description": "Configuration for automated test jobs",
            "properties": {
              "ttlSecondsAfterFinished": {
                "type": "string",
                "description": "Time to keep test job resources after completion (seconds)",
                "default": "3600"
              },
              "activeDeadlineSeconds": {
                "type": "string",
                "description": "Maximum time for the test job to run (seconds)",
                "default": "300"
              },
              "backoffLimit": {
                "type": "integer",
                "description": "Number of retries for the test job",
                "default": 0
              },
              "apikey": {
                "type": "string",
                "description": "API key for the test engine, can be a direct value or a vault reference"
              },
              "webhook_url": {
                "type": "string",
                "description": "URL of the test engine webhook, can be a direct value or a vault reference"
              },
              "resources": {
                "type": "object",
                "description": "Resource requests and limits for the test job pod",
                "properties": {
                  "requests": {
                    "type": "object",
                    "properties": {
                      "cpu": {
                        "type": "string",
                        "default": "100m"
                      },
                      "memory": {
                        "type": "string",
                        "default": "128Mi"
                      }
                    }
                  },
                  "limits": {
                    "type": "object",
                    "properties": {
                      "cpu": {
                        "type": "string",
                        "default": "500m"
                      },
                      "memory": {
                        "type": "string",
                        "default": "256Mi"
                      }
                    }
                  }
                }
              },
              "testdefinitions": {
                "type": "array",
                "description": "Test definitions to run",
                "items": {
                  "type": "object",
                  "required": ["name", "containerImage", "containerTag", "secretId"],
                  "properties": {
                    "name": {
                      "type": "string",
                      "description": "Name of the test suite"
                    },
                    "containerImage": {
                      "type": "string",
                      "description": "Container image to use for running tests"
                    },
                    "containerTag": {
                      "type": "string",
                      "description": "Tag of the container image"
                    },
                    "secretId": {
                      "type": "string",
                      "description": "Reference to secrets needed for tests, can be a direct value or a vault reference"
                    },
                    "filters": {
                      "type": "array",
                      "description": "Test filters to select which tests to run",
                      "items": {
                        "type": "string"
                      },
                      "default": []
                    },
                    "serviceAddress": {
                      "type": "string",
                      "description": "Optional service address for the test to target"
                    },
                    "additionalEnvVars": {
                      "type": "string",
                      "description": "Additional environment variables to pass to the test container"
                    }
                  }
                }
              }
            }
          },
          "deploymentType": {
            "type": "string",
            "description": "Type of deployment",
            "enum": ["deployment", "statefulset", "rollout"],
            "default": "deployment"
          },
          "migratingToRollouts": {
            "oneOf": [
              {
                "type": "boolean",
                "description": "Whether the application is migrating to Argo Rollouts",
                "default": false
              },
              {
                "type": "null"
              }
            ]
          },
          "version": {
            "oneOf": [
              {
                "type": "string",
                "description": "Application version string"
              },
              {
                "type": "object",
                "description": "Application version as object",
                "properties": {
                  "tag": {
                    "type": "string",
                    "description": "Version tag"
                  }
                }
              },
              {
                "type": "null"
              }
            ],
            "description": "Application version"
          },
          "env": {
            "type": "object",
            "description": "Environment variables",
            "additionalProperties": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "object",
                  "description": "Environment variable from source",
                  "properties": {
                    "valueFrom": {
                      "type": "object"
                    }
                  }
                }
              ]
            }
          },
          "image": {
            "type": "object",
            "required": ["registry", "repository", "tag"],
            "properties": {
              "registry": {
                "type": "string",
                "description": "Docker registry URL",
                "default": "mycarrieracr.azurecr.io"
              },
              "repository": {
                "type": "string",
                "description": "Docker image repository"
              },
              "tag": {
                "type": "string",
                "description": "Docker image tag"
              }
            }
          },
          "pullPolicy": {
            "oneOf": [
              {
                "type": "string",
                "description": "Image pull policy",
                "enum": ["IfNotPresent", "Always", "Never"],
                "default": "IfNotPresent"
              },
              {
                "type": "null"
              }
            ]
          },
          "pullSecret": {
            "oneOf": [
              {
                "type": "string",
                "description": "Name of the pull secret",
                "default": "imagepull"
              },
              {
                "type": "null"
              }
            ]
          },
          "command": {
            "type": "array",
            "description": "Command to run in the container",
            "items": {
              "type": "string"
            }
          },
          "args": {
            "type": "array",
            "description": "Arguments to pass to the command",
            "items": {
              "type": "string"
            }
          },
          "ports": {
            "type": "object",
            "description": "Ports to expose",
            "additionalProperties": {
              "type": "integer"
            }
          },
          "volumes": {
            "type": "array",
            "description": "Volumes to mount",
            "items": {
              "type": "object",
              "required": ["name", "mountPath"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Name of the volume"
                },
                "kind": {
                  "type": "string",
                  "description": "Kind of volume",
                  "enum": ["emptyDir", "configMap", "secret"]
                },
                "mountPath": {
                  "type": "string",
                  "description": "Path to mount the volume"
                },
                "subPath": {
                  "type": "string",
                  "description": "Subpath within the volume to mount"
                },
                "configMapName": {
                  "type": "string",
                  "description": "Name of the configMap (if kind is configMap)"
                },
                "items": {
                  "type": "array",
                  "description": "Items to include from the configMap",
                  "items": {
                    "type": "object",
                    "required": ["key", "path"],
                    "properties": {
                      "key": {
                        "type": "string"
                      },
                      "path": {
                        "type": "string"
                      }
                    }
                  }
                },
                "custom": {
                  "type": "object",
                  "description": "Custom volume definition"
                }
              }
            }
          },
          "resources": {
            "type": "object",
            "properties": {
              "requests": {
                "type": "object",
                "properties": {
                  "cpu": {
                    "type": "string",
                    "default": "50m"
                  },
                  "memory": {
                    "type": "string",
                    "default": "128Mi"
                  }
                }
              },
              "limits": {
                "type": "object",
                "properties": {
                  "cpu": {
                    "type": "string",
                    "default": "2000m"
                  },
                  "memory": {
                    "type": "string",
                    "default": "2048Mi"
                  }
                }
              }
            }
          },
          "securityContext": {
            "type": "object",
            "properties": {
              "readOnlyRootFilesystem": {
                "type": "boolean",
                "default": false
              }
            }
          },
          "replicas": {
            "type": "integer",
            "description": "Number of pod replicas",
            "default": 1
          },
          "probes": {
            "type": "object",
            "properties": {
              "enableLiveness": {
                "type": "boolean",
                "default": true
              },
              "enableReadiness": {
                "type": "boolean",
                "default": true
              },
              "enableStartup": {
                "type": "boolean",
                "default": false
              },
              "livenessProbe": {
                "type": "object",
                "description": "Custom liveness probe configuration"
              },
              "readinessProbe": {
                "type": "object",
                "description": "Custom readiness probe configuration"
              },
              "startupProbe": {
                "type": "object",
                "description": "Custom startup probe configuration"
              }
            }
          },
          "service": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["ClusterIP", "NodePort", "LoadBalancer"],
                "default": "ClusterIP"
              },
              "headless": {
                "type": "boolean",
                "description": "Whether the service is headless",
                "default": false
              },
              "ports": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["name", "port"],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "port": {
                      "type": "integer"
                    },
                    "targetPort": {
                      "type": "integer"
                    },
                    "protocol": {
                      "type": "string",
                      "default": "TCP"
                    }
                  }
                }
              },
              "annotations": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              },
              "timeout": {
                "type": "string",
                "default": "151s"
              },
              "retryOn": {
                "type": "string",
                "default": "5xx,reset"
              },
              "attempts": {
                "type": "integer",
                "default": 3
              },
              "perTryTimeout": {
                "type": "string",
                "default": "50s"
              },
              "affinityTimeoutSeconds": {
                "type": "integer"
              },
              "istioDisabled": {
                "type": "boolean",
                "default": false
              }
            }
          },
          "networking": {
            "oneOf": [
              {
                "type": "object",
                "properties": {
                  "ingress": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string"
                      }
                    }
                  },
                  "istio": {
                    "oneOf": [
                      {
                        "type": "object",
                        "properties": {
                          "enabled": {
                            "type": "boolean",
                            "default": true
                          },
                          "hosts": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "redirects": {
                            "type": "object",
                            "additionalProperties": {
                              "type": "string"
                            }
                          },
                          "routes": {
                            "type": "object",
                            "additionalProperties": {
                              "type": "object"
                            }
                          },
                          "responseHeaders": {
                            "type": "object",
                            "properties": {
                              "response": {
                                "type": "object",
                                "properties": {
                                  "set": {
                                    "type": "object",
                                    "additionalProperties": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "corsPolicy": {
                            "type": "object"
                          },
                          "allowedEndpoints": {
                            "type": "array",
                            "description": "List of allowed HTTP endpoints for the VirtualService. Can be strings with wildcards or objects with kind and match fields.",
                            "items": {
                              "oneOf": [
                                {
                                  "type": "string",
                                  "description": "Endpoint path as a string. If it contains *, it will be treated as a prefix match, otherwise as an exact match."
                                },
                                {
                                  "type": "object",
                                  "description": "Endpoint definition with explicit kind (prefix, exact, or regex) and match pattern.",
                                  "required": ["kind", "match"],
                                  "properties": {
                                    "kind": {
                                      "type": "string",
                                      "enum": ["prefix", "exact", "regex"],
                                      "description": "Type of URI matching: prefix for path prefixes, exact for exact matches, regex for regular expressions."
                                    },
                                    "match": {
                                      "type": "string",
                                      "description": "The URI pattern to match against incoming requests."
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        }
                      },
                      {
                        "type": "null"
                      }
                    ]
                  },
                  "krakend": {
                    "type": "object"
                  }
                }
              },
              {
                "type": "null"
              }
            ]
          },
          "initContainers": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "image"],
              "properties": {
                "name": {
                  "type": "string"
                },
                "image": {
                  "type": "string"
                },
                "tag": {
                  "type": "string"
                },
                "command": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "args": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "env": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "serviceAccount": {
            "type": "object",
            "properties": {
              "create": {
                "type": "boolean",
                "default": false
              }
            }
          },
          "nodeSelector": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "priorityClassName": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ]
          },
          "updateStrategy": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["RollingUpdate", "Recreate"],
                "default": "RollingUpdate"
              },
              "rollingUpdate": {
                "type": "object",
                "properties": {
                  "maxUnavailable": {
                    "oneOf": [
                      { "type": "integer" },
                      { "type": "string" }
                    ],
                    "default": 0
                  },
                  "maxSurge": {
                    "oneOf": [
                      { "type": "integer" },
                      { "type": "string" }
                    ],
                    "default": 2
                  }
                }
              },
              "canary": {
                "type": "object",
                "properties": {
                  "steps": {
                    "type": "array",
                    "items": {
                      "type": "object"
                    }
                  },
                  "scaleDownDelaySeconds": {
                    "type": "integer",
                    "default": 30
                  },
                  "scaleDownDelayRevisionLimit": {
                    "type": "integer",
                    "default": 5
                  },
                  "abortScaleDownDelaySeconds": {
                    "type": "integer",
                    "default": 30
                  },
                  "backgroundanalysis": {
                    "type": "object",
                    "properties": {
                      "templates": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      },
                      "args": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      }
                    }
                  }
                }
              },
              "bluegreen": {
                "type": "object",
                "properties": {
                  "prePromotionAnalysis": {
                    "type": "object",
                    "properties": {
                      "templates": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      },
                      "args": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      }
                    }
                  },
                  "postPromotionAnalysis": {
                    "type": "object",
                    "properties": {
                      "templates": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      },
                      "args": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "analysisTemplates": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "provider"],
              "properties": {
                "name": {
                  "type": "string"
                },
                "count": {
                  "type": "integer",
                  "default": 1
                },
                "failureLimit": {
                  "type": "integer",
                  "default": 0
                },
                "provider": {
                  "type": "object",
                  "oneOf": [
                    {
                      "properties": {
                        "job": {
                          "type": "object",
                          "properties": {
                            "container": {
                              "type": "object",
                              "properties": {
                                "image": {
                                  "type": "object",
                                  "properties": {
                                    "registry": {
                                      "type": "string"
                                    },
                                    "repository": {
                                      "type": "string"
                                    },
                                    "tag": {
                                      "type": "string"
                                    }
                                  }
                                },
                                "args": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "env": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "name": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "required": ["job"]
                    },
                    {
                      "properties": {
                        "web": {
                          "type": "object",
                          "properties": {
                            "url": {
                              "type": "string"
                            },
                            "statusEndpoint": {
                              "type": "string"
                            },
                            "successCondition": {
                              "type": "string",
                              "default": "result == \"Healthy\""
                            }
                          }
                        }
                      },
                      "required": ["web"]
                    }
                  ]
                }
              }
            }
          },
          "serviceMonitor": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": false
              },
              "interval": {
                "type": "string",
                "default": "30s"
              },
              "scrapeTimeout": {
                "type": "string",
                "default": "10s"
              },
              "scheme": {
                "type": "string",
                "default": "http"
              },
              "relabelings": {
                "type": "array",
                "items": {
                  "type": "object"
                }
              },
              "metricRelabelings": {
                "type": "array",
                "items": {
                  "type": "object"
                }
              },
              "tlsConfig": {
                "type": "object"
              }
            }
          },
          "lifecycle": {
            "type": "object",
            "properties": {
              "postStart": {
                "type": "string",
                "description": "Command to run on container post-start"
              },
              "preStop": {
                "type": "string",
                "description": "Command to run on container pre-stop"
              }
            }
          },
          "vpa": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean",
                "description": "Enable Vertical Pod Autoscaler",
                "default": false
              },
              "controlledValues": {
                "type": "string",
                "description": "Values controlled by VPA",
                "enum": ["RequestsOnly", "RequestsAndLimits"],
                "default": "RequestsOnly"
              },
              "updateMode": {
                "type": "string",
                "description": "VPA update mode",
                "enum": ["Off", "Initial", "Auto"],
                "default": "Auto"
              }
            }
          },
          "autoscaling": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean",
                "description": "Enable Horizontal Pod Autoscaler",
                "default": false
              },
              "minReplicas": {
                "type": "integer",
                "description": "Minimum number of replicas",
                "default": 2
              },
              "maxReplicas": {
                "type": "integer",
                "description": "Maximum number of replicas",
                "default": 5
              },
              "targetCPUUtilizationPercentage": {
                "type": "integer",
                "description": "Target CPU utilization percentage",
                "default": 80
              },
              "targetMemoryUtilizationPercentage": {
                "type": "integer",
                "description": "Target memory utilization percentage"
              }
            }
          }
        }
      }
    },
    "additionalProperties": false
    },
    "jobs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "image"],
        "properties": {
          "name": {
            "type": "string"
          },
          "timing": {
            "type": "string",
            "enum": ["pre-deploy", "post-deploy"]
          },
          "order": {
            "type": "integer",
            "default": 0
          },
          "labels": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "annotations": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "ttlSecondsAfterFinished": {
            "type": "integer"
          },
          "activeDeadlineSeconds": {
            "type": "integer"
          },
          "backoffLimit": {
            "type": "integer",
            "default": 0
          },
          "restartPolicy": {
            "type": "string",
            "enum": ["Never", "OnFailure"],
            "default": "Never"
          },
          "image": {
            "type": "object",
            "properties": {
              "registry": {
                "type": "string"
              },
              "repository": {
                "type": "string"
              },
              "tag": {
                "type": "string"
              }
            }
          },
          "imagePullPolicy": {
            "type": "string",
            "enum": ["IfNotPresent", "Always", "Never"],
            "default": "IfNotPresent"
          },
          "imagePullSecret": {
            "type": "string",
            "default": "imagepull"
          },
          "command": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "args": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "env": {
            "type": "object",
            "description": "Environment variables as key-value pairs or references",
            "additionalProperties": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "object",
                  "properties": {
                    "secretKeyRef": {
                      "type": "object",
                      "properties": {
                        "name": { "type": "string" },
                        "key": { "type": "string" }
                      }
                    },
                    "configMapKeyRef": {
                      "type": "object",
                      "properties": {
                        "name": { "type": "string" },
                        "key": { "type": "string" }
                      }
                    },
                    "fieldRef": {
                      "type": "object",
                      "properties": {
                        "fieldPath": { "type": "string" }
                      }
                    },
                    "resourceFieldRef": {
                      "type": "object",
                      "properties": {
                        "containerName": { "type": "string" },
                        "resource": { "type": "string" }
                      }
                    }
                  }
                }
              ]
            }
          },
          "configMapName": {
            "type": "string"
          },
          "secretName": {
            "type": "string"
          },
          "resources": {
            "type": "object",
            "properties": {
              "requests": {
                "type": "object",
                "properties": {
                  "cpu": {
                    "type": "string",
                    "default": "100m"
                  },
                  "memory": {
                    "type": "string",
                    "default": "128Mi"
                  }
                }
              },
              "limits": {
                "type": "object",
                "properties": {
                  "cpu": {
                    "type": "string",
                    "default": "500m"
                  },
                  "memory": {
                    "type": "string",
                    "default": "256Mi"
                  }
                }
              }
            }
          },
          "volumes": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "mountPath"],
              "properties": {
                "name": {
                  "type": "string"
                },
                "mountPath": {
                  "type": "string"
                },
                "subPath": {
                  "type": "string"
                },
                "configMapName": {
                  "type": "string"
                },
                "items": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "key": {
                        "type": "string"
                      },
                      "path": {
                        "type": "string"
                      }
                    }
                  }
                },
                "custom": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "cronjobs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "schedule", "image"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the cronjob"
          },
          "schedule": {
            "type": "string",
            "description": "Cron schedule expression (e.g., '0 2 * * *')"
          },
          "timeZone": {
            "type": "string",
            "description": "Time zone for the cron schedule (e.g., 'UTC', 'America/New_York')"
          },
          "concurrencyPolicy": {
            "type": "string",
            "enum": ["Allow", "Forbid", "Replace"],
            "description": "How to handle concurrent job executions",
            "default": "Forbid"
          },
          "suspend": {
            "type": "boolean",
            "description": "Whether to suspend the cronjob",
            "default": false
          },
          "successfulJobsHistoryLimit": {
            "type": "integer",
            "description": "Number of successful jobs to keep in history",
            "default": 3
          },
          "failedJobsHistoryLimit": {
            "type": "integer",
            "description": "Number of failed jobs to keep in history",
            "default": 1
          },
          "startingDeadlineSeconds": {
            "type": "integer",
            "description": "Deadline in seconds for starting the job if it misses scheduled time"
          },
          "labels": {
            "type": "object",
            "description": "Custom labels to add to the cronjob resources",
            "additionalProperties": {
              "type": "string"
            }
          },
          "annotations": {
            "type": "object",
            "description": "Custom annotations to add to the cronjob resources",
            "additionalProperties": {
              "type": "string"
            }
          },
          "activeDeadlineSeconds": {
            "type": "integer",
            "description": "Maximum time for the job to run (seconds)"
          },
          "backoffLimit": {
            "type": "integer",
            "description": "Number of retries before considering job failed",
            "default": 0
          },
          "restartPolicy": {
            "type": "string",
            "enum": ["Never", "OnFailure"],
            "description": "Restart policy for the job pods",
            "default": "Never"
          },
          "image": {
            "type": "object",
            "required": ["registry", "repository", "tag"],
            "properties": {
              "registry": {
                "type": "string",
                "description": "Docker registry URL"
              },
              "repository": {
                "type": "string",
                "description": "Docker image repository"
              },
              "tag": {
                "type": "string",
                "description": "Docker image tag"
              }
            }
          },
          "imagePullPolicy": {
            "type": "string",
            "enum": ["IfNotPresent", "Always", "Never"],
            "description": "Image pull policy",
            "default": "IfNotPresent"
          },
          "imagePullSecret": {
            "type": "string",
            "description": "Name of the image pull secret",
            "default": "imagepull"
          },
          "command": {
            "type": "array",
            "description": "Command to run in the container",
            "items": {
              "type": "string"
            }
          },
          "args": {
            "type": "array",
            "description": "Arguments to pass to the command",
            "items": {
              "type": "string"
            }
          },
          "env": {
            "type": "object",
            "description": "Environment variables as key-value pairs or references",
            "additionalProperties": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "object",
                  "properties": {
                    "secretKeyRef": {
                      "type": "object",
                      "properties": {
                        "name": { "type": "string" },
                        "key": { "type": "string" }
                      }
                    },
                    "configMapKeyRef": {
                      "type": "object",
                      "properties": {
                        "name": { "type": "string" },
                        "key": { "type": "string" }
                      }
                    },
                    "fieldRef": {
                      "type": "object",
                      "properties": {
                        "fieldPath": { "type": "string" }
                      }
                    },
                    "resourceFieldRef": {
                      "type": "object",
                      "properties": {
                        "containerName": { "type": "string" },
                        "resource": { "type": "string" }
                      }
                    }
                  }
                }
              ]
            }
          },
          "configMapName": {
            "type": "string",
            "description": "Name of the ConfigMap to use for environment variables"
          },
          "secretName": {
            "type": "string",
            "description": "Name of the Secret to use for environment variables"
          },
          "resources": {
            "type": "object",
            "description": "Resource requests and limits",
            "properties": {
              "requests": {
                "type": "object",
                "properties": {
                  "cpu": {
                    "type": "string",
                    "default": "100m"
                  },
                  "memory": {
                    "type": "string",
                    "default": "128Mi"
                  }
                }
              },
              "limits": {
                "type": "object",
                "properties": {
                  "cpu": {
                    "type": "string",
                    "default": "500m"
                  },
                  "memory": {
                    "type": "string",
                    "default": "256Mi"
                  }
                }
              }
            }
          },
          "volumes": {
            "type": "array",
            "description": "Volumes to mount in the cronjob",
            "items": {
              "type": "object",
              "required": ["name", "mountPath"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Name of the volume"
                },
                "mountPath": {
                  "type": "string",
                  "description": "Path where the volume will be mounted"
                },
                "subPath": {
                  "type": "string",
                  "description": "Subpath within the volume to mount"
                },
                "kind": {
                  "type": "string",
                  "description": "Type of volume",
                  "enum": ["emptyDir", "configMap", "secret"]
                },
                "configMapName": {
                  "type": "string",
                  "description": "Name of the ConfigMap (if kind is configMap)"
                },
                "items": {
                  "type": "array",
                  "description": "Items to include from the ConfigMap",
                  "items": {
                    "type": "object",
                    "properties": {
                      "key": {
                        "type": "string"
                      },
                      "path": {
                        "type": "string"
                      }
                    }
                  }
                },
                "custom": {
                  "type": "object",
                  "description": "Custom volume definition"
                }
              }
            }
          }
        }
      }
    },
    "secrets": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "bulk": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "path": {
                      "oneOf": [
                        { "type": "string", "description": "Path to secrets in vault" },
                        { "type": "null", "description": "Null value when no vault path is needed" }
                      ],
                      "description": "Path to secrets in vault"
                    }
                  }
                },
                { "type": "null", "description": "Null value when no bulk secrets are needed" }
              ]
            },
        "individual": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["envVarName"],
            "properties": {
              "envVarName": {
                "type": "string",
                "description": "Name of the environment variable"
              },
              "path": {
                "oneOf": [
                  { "type": "string", "description": "Path to the secret in vault" },
                  { "type": "null" }
                ]
              },
              "keyName": {
                "oneOf": [
                  { "type": "string", "description": "Key in the secret", "default": "value" },
                  { "type": "null" }
                ]
              }
            }
          }
        },
        "mounted": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "oneOf": [
                  { "type": "string", "description": "Name for the secret" },
                  { "type": "null" }
                ]
              },
              "mountedFileName": {
                "oneOf": [
                  { "type": "string", "description": "Filename for the mounted secret" },
                  { "type": "null" }
                ]
              },
              "vault": {
                "type": "object",
                "required": ["path", "property"],
                "properties": {
                  "path": {
                    "oneOf": [
                      { "type": "string", "description": "Path to the secret in vault" },
                      { "type": "null" }
                    ]
                  },
                  "property": {
                    "oneOf": [
                      { "type": "string", "description": "Property in the secret" },
                      { "type": "null" }
                    ]
                  }
                }
              },
              "mount": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "Path to mount the secret"
                  },
                  "subPath": {
                    "oneOf": [
                      { "type": "string", "description": "Subpath within the mount" },
                      { "type": "null", "description": "Null value when no subPath is needed" }
                    ],
                    "description": "Subpath within the mount"
                  }
                }
              }
            }
          }
        }
      }
    },
    { "type": "null", "description": "Null value when no secrets are needed" }
      ]
    }
  }
}